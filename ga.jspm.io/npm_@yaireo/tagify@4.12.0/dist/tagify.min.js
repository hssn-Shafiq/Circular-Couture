var w="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var b={};!function(w,y){b=y()}(0,(function(){function t(w,b){var y=Object.keys(w);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(w);b&&(x=x.filter((function(b){return Object.getOwnPropertyDescriptor(w,b).enumerable}))),y.push.apply(y,x)}return y}function e(w){for(var b=1;b<arguments.length;b++){var y=null!=arguments[b]?arguments[b]:{};b%2?t(Object(y),!0).forEach((function(b){i(w,b,y[b])})):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(y)):t(Object(y)).forEach((function(b){Object.defineProperty(w,b,Object.getOwnPropertyDescriptor(y,b))}))}return w}function i(w,b,y){return b in w?Object.defineProperty(w,b,{value:y,enumerable:!0,configurable:!0,writable:!0}):w[b]=y,w}const s=(w,b,y,x)=>(w=""+w,b=""+b,x&&(w=w.trim(),b=b.trim()),y?w==b:w.toLowerCase()==b.toLowerCase()),a=(w,b)=>w&&Array.isArray(w)&&w.map((w=>n(w,b)));function n(w,b){var y,x={};for(y in w)b.indexOf(y)<0&&(x[y]=w[y]);return x}function o(w){var b=document.createElement("div");return w.replace(/\&#?[0-9a-z]+;/gi,(function(w){return b.innerHTML=w,b.innerText}))}function r(w){return(new DOMParser).parseFromString(w.trim(),"text/html").body.firstElementChild}function l(w,b){for(b=b||"previous";w=w[b+"Sibling"];)if(3==w.nodeType)return w}function d(w){return"string"==typeof w?w.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/`|'/g,"&#039;"):w}function h(w){var b=Object.prototype.toString.call(w).split(" ")[1].slice(0,-1);return w===Object(w)&&"Array"!=b&&"Function"!=b&&"RegExp"!=b&&"HTMLUnknownElement"!=b}function g(w,b,y){function s(w,b){for(var y in b)if(b.hasOwnProperty(y)){if(h(b[y])){h(w[y])?s(w[y],b[y]):w[y]=Object.assign({},b[y]);continue}if(Array.isArray(b[y])){w[y]=Object.assign([],b[y]);continue}w[y]=b[y]}}return w instanceof Object||(w={}),s(w,b),y&&s(w,y),w}function p(){const w=[],b={};for(let y of arguments)for(let x of y)h(x)?b[x.value]||(w.push(x),b[x.value]=1):w.includes(x)||w.push(x);return w}function c(w){return String.prototype.normalize?"string"==typeof w?w.normalize("NFD").replace(/[\u0300-\u036f]/g,""):void 0:w}var u=()=>/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent);function m(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(w=>(w^crypto.getRandomValues(new Uint8Array(1))[0]&15>>w/4).toString(16)))}function v(b){return b&&b.classList&&b.classList.contains((this||w).settings.classNames.tag)}var b={delimiters:",",pattern:null,tagTextProp:"value",maxTags:1/0,callbacks:{},addTagOnBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,keepInvalidTags:!1,mixTagsAllowedAfter:/,|\.|\:|\s/,mixTagsInterpolator:["[[","]]"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:()=>{},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:" "},autoComplete:{enabled:!0,rightKey:!1},classNames:{namespace:"tagify",mixMode:"tagify--mix",selectMode:"tagify--select",input:"tagify__input",focus:"tagify--focus",tagNoAnimation:"tagify--noAnim",tagInvalid:"tagify--invalid",tagNotAllowed:"tagify--notAllowed",scopeLoading:"tagify--loading",hasMaxTags:"tagify--hasMaxTags",hasNoTags:"tagify--noTags",empty:"tagify--empty",inputInvalid:"tagify__input--invalid",dropdown:"tagify__dropdown",dropdownWrapper:"tagify__dropdown__wrapper",dropdownHeader:"tagify__dropdown__header",dropdownFooter:"tagify__dropdown__footer",dropdownItem:"tagify__dropdown__item",dropdownItemActive:"tagify__dropdown__item--active",dropdownInital:"tagify__dropdown--initial",tag:"tagify__tag",tagText:"tagify__tag-text",tagX:"tagify__tag__removeBtn",tagLoading:"tagify__tag--loading",tagEditing:"tagify__tag--editable",tagFlash:"tagify__tag--flash",tagHide:"tagify__tag--hide"},dropdown:{classname:"",enabled:2,maxItems:10,searchKeys:["value","searchBy"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,highlightFirst:!1,closeOnSelect:!0,clearOnSelect:!0,position:"all",appendTarget:null},hooks:{beforeRemoveTag:()=>Promise.resolve(),beforePaste:()=>Promise.resolve(),suggestionClick:()=>Promise.resolve()}};function T(){(this||w).dropdown={};for(let b in(this||w)._dropdown)(this||w).dropdown[b]="function"==typeof(this||w)._dropdown[b]?(this||w)._dropdown[b].bind(this||w):(this||w)._dropdown[b];(this||w).dropdown.refs()}var y={refs(){(this||w).DOM.dropdown=this.parseTemplate("dropdown",[(this||w).settings]),(this||w).DOM.dropdown.content=(this||w).DOM.dropdown.querySelector("[data-selector='tagify-dropdown-wrapper']")},show(b){var y,x,D,O=(this||w).settings,I="mix"==O.mode&&!O.enforceWhitelist,E=!O.whitelist||!O.whitelist.length,N="manual"==O.dropdown.position;if(b=void 0===b?(this||w).state.inputText:b,(!E||I||O.templates.dropdownItemNoMatch)&&!1!==O.dropdown.enable&&!(this||w).state.isLoading){if(clearTimeout((this||w).dropdownHide__bindEventsTimeout),(this||w).suggestedListItems=(this||w).dropdown.filterListItems(b),b&&!(this||w).suggestedListItems.length&&(this.trigger("dropdown:noMatch",b),O.templates.dropdownItemNoMatch&&(D=O.templates.dropdownItemNoMatch.call(this||w,{value:b}))),!D){if((this||w).suggestedListItems.length)b&&I&&!(this||w).state.editing.scope&&!s((this||w).suggestedListItems[0].value,b)&&(this||w).suggestedListItems.unshift({value:b});else{if(!b||!I||(this||w).state.editing.scope)return(this||w).input.autocomplete.suggest.call(this||w),void(this||w).dropdown.hide();(this||w).suggestedListItems=[{value:b}]}x=""+(h(y=(this||w).suggestedListItems[0])?y.value:y),O.autoComplete&&x&&0==x.indexOf(b)&&(this||w).input.autocomplete.suggest.call(this||w,y)}(this||w).dropdown.fill(D),O.dropdown.highlightFirst&&(this||w).dropdown.highlightOption((this||w).DOM.dropdown.content.children[0]),(this||w).state.dropdown.visible||setTimeout((this||w).dropdown.events.binding.bind(this||w)),(this||w).state.dropdown.visible=b||!0,(this||w).state.dropdown.query=b,this.setStateSelection(),N||setTimeout((()=>{(this||w).dropdown.position(),(this||w).dropdown.render()})),setTimeout((()=>{this.trigger("dropdown:show",(this||w).DOM.dropdown)}))}},hide(b){var y=(this||w).DOM,x=y.scope,D=y.dropdown,O="manual"==(this||w).settings.dropdown.position&&!b;if(D&&document.body.contains(D)&&!O)return window.removeEventListener("resize",(this||w).dropdown.position),(this||w).dropdown.events.binding.call(this||w,!1),x.setAttribute("aria-expanded",!1),D.parentNode.removeChild(D),setTimeout((()=>{(this||w).state.dropdown.visible=!1}),100),(this||w).state.dropdown.query=(this||w).state.ddItemData=(this||w).state.ddItemElm=(this||w).state.selection=null,(this||w).state.tag&&(this||w).state.tag.value.length&&((this||w).state.flaggedTags[(this||w).state.tag.baseOffset]=(this||w).state.tag),this.trigger("dropdown:hide",D),this||w},toggle(b){(this||w).dropdown[(this||w).state.dropdown.visible&&!b?"hide":"show"]()},render(){var b,y,x,D=(b=(this||w).DOM.dropdown,(x=b.cloneNode(!0)).style.cssText="position:fixed; top:-9999px; opacity:0",document.body.appendChild(x),y=x.clientHeight,x.parentNode.removeChild(x),y),O=(this||w).settings;return"number"==typeof O.dropdown.enabled&&O.dropdown.enabled>=0?((this||w).DOM.scope.setAttribute("aria-expanded",!0),document.body.contains((this||w).DOM.dropdown)||((this||w).DOM.dropdown.classList.add(O.classNames.dropdownInital),(this||w).dropdown.position(D),O.dropdown.appendTarget.appendChild((this||w).DOM.dropdown),setTimeout((()=>(this||w).DOM.dropdown.classList.remove(O.classNames.dropdownInital)))),this||w):this||w},fill(b){b="string"==typeof b?b:(this||w).dropdown.createListHTML(b||(this||w).suggestedListItems);var y,x=(this||w).settings.templates.dropdownContent.call(this||w,b);(this||w).DOM.dropdown.content.innerHTML=(y=x)?y.replace(/\>[\r\n ]+\</g,"><").replace(/(<.*?>)|\s+/g,((w,b)=>b||" ")):""},refilter(b){b=b||(this||w).state.dropdown.query||"",(this||w).suggestedListItems=(this||w).dropdown.filterListItems(b),(this||w).dropdown.fill(),(this||w).suggestedListItems.length||(this||w).dropdown.hide(),this.trigger("dropdown:updated",(this||w).DOM.dropdown)},position(b){var y=(this||w).settings.dropdown;if("manual"!=y.position){var x,D,O,I,E,N,_=(this||w).DOM.dropdown,S=y.placeAbove,C=document.documentElement.clientHeight,A=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)>480?y.position:"all",L=(this||w).DOM["input"==A?"input":"scope"];b=b||_.clientHeight,(this||w).state.dropdown.visible&&("text"==A?(O=(x=this.getCaretGlobalPosition()).bottom,D=x.top,I=x.left,E="auto"):(N=function(w){for(var b=0,y=0;w;)b+=w.offsetLeft||0,y+=w.offsetTop||0,w=w.parentNode;return{left:b,top:y}}((this||w).settings.dropdown.appendTarget),D=(x=L.getBoundingClientRect()).top-N.top,O=x.bottom-1-N.top,I=x.left-N.left,E=x.width+"px"),D=Math.floor(D),O=Math.ceil(O),S=void 0===S?C-x.bottom<b:S,_.style.cssText="left:"+(I+window.pageXOffset)+"px; width:"+E+";"+(S?"top: "+(D+window.pageYOffset)+"px":"top: "+(O+window.pageYOffset)+"px"),_.setAttribute("placement",S?"top":"bottom"),_.setAttribute("position",A))}},events:{binding(b=!0){var y=(this||w).dropdown.events.callbacks,x=(this||w).listeners.dropdown=(this||w).listeners.dropdown||{position:(this||w).dropdown.position.bind(this||w),onKeyDown:y.onKeyDown.bind(this||w),onMouseOver:y.onMouseOver.bind(this||w),onMouseLeave:y.onMouseLeave.bind(this||w),onClick:y.onClick.bind(this||w),onScroll:y.onScroll.bind(this||w)},D=b?"addEventListener":"removeEventListener";"manual"!=(this||w).settings.dropdown.position&&(window[D]("resize",x.position),window[D]("keydown",x.onKeyDown)),(this||w).DOM.dropdown[D]("mouseover",x.onMouseOver),(this||w).DOM.dropdown[D]("mouseleave",x.onMouseLeave),(this||w).DOM.dropdown[D]("mousedown",x.onClick),(this||w).DOM.dropdown.content[D]("scroll",x.onScroll)},callbacks:{onKeyDown(b){var y=(this||w).DOM.dropdown.querySelector((this||w).settings.classNames.dropdownItemActiveSelector),x=(this||w).dropdown.getSuggestionDataByNode(y);switch(b.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":var D;b.preventDefault(),y&&(y=y[("ArrowUp"==b.key||"Up"==b.key?"previous":"next")+"ElementSibling"]),y||(D=(this||w).DOM.dropdown.content.children,y=D["ArrowUp"==b.key||"Up"==b.key?D.length-1:0]),x=(this||w).dropdown.getSuggestionDataByNode(y),(this||w).dropdown.highlightOption(y,!0);break;case"Escape":case"Esc":(this||w).dropdown.hide();break;case"ArrowRight":if((this||w).state.actions.ArrowLeft)return;case"Tab":if("mix"!=(this||w).settings.mode&&y&&!(this||w).settings.autoComplete.rightKey&&!(this||w).state.editing){b.preventDefault();var O=(this||w).dropdown.getMappedValue(x);return(this||w).input.autocomplete.set.call(this||w,O),!1}return!0;case"Enter":b.preventDefault(),(this||w).settings.hooks.suggestionClick(b,{tagify:this||w,tagData:x,suggestionElm:y}).then((()=>{if(y)return(this||w).dropdown.selectOption(y);(this||w).dropdown.hide(),"mix"!=(this||w).settings.mode&&this.addTags((this||w).state.inputText.trim(),!0)})).catch((w=>w));break;case"Backspace":{if("mix"==(this||w).settings.mode||(this||w).state.editing.scope)return;const b=(this||w).input.raw.call(this||w);""!=b&&8203!=b.charCodeAt(0)||(!0===(this||w).settings.backspace?this.removeTags():"edit"==(this||w).settings.backspace&&setTimeout((this||w).editTag.bind(this||w),0))}}},onMouseOver(b){var y=b.target.closest((this||w).settings.classNames.dropdownItemSelector);y&&(this||w).dropdown.highlightOption(y)},onMouseLeave(b){(this||w).dropdown.highlightOption()},onClick(b){if(0==b.button&&b.target!=(this||w).DOM.dropdown&&b.target!=(this||w).DOM.dropdown.content){var y=b.target.closest((this||w).settings.classNames.dropdownItemSelector),x=(this||w).dropdown.getSuggestionDataByNode(y);(this||w).state.actions.selectOption=!0,setTimeout((()=>(this||w).state.actions.selectOption=!1),50),(this||w).settings.hooks.suggestionClick(b,{tagify:this||w,tagData:x,suggestionElm:y}).then((()=>{y?(this||w).dropdown.selectOption(y):(this||w).dropdown.hide()})).catch((w=>console.warn(w)))}},onScroll(w){var b=w.target,y=b.scrollTop/(b.scrollHeight-b.parentNode.clientHeight)*100;this.trigger("dropdown:scroll",{percentage:Math.round(y)})}}},getSuggestionDataByNode(b){var y=b?+b.getAttribute("tagifySuggestionIdx"):-1;return(this||w).suggestedListItems[y]||null},highlightOption(b,y){var x,D=(this||w).settings.classNames.dropdownItemActive;if((this||w).state.ddItemElm&&((this||w).state.ddItemElm.classList.remove(D),(this||w).state.ddItemElm.removeAttribute("aria-selected")),!b)return(this||w).state.ddItemData=null,(this||w).state.ddItemElm=null,void(this||w).input.autocomplete.suggest.call(this||w);x=(this||w).suggestedListItems[this.getNodeIndex(b)],(this||w).state.ddItemData=x,(this||w).state.ddItemElm=b,b.classList.add(D),b.setAttribute("aria-selected",!0),y&&(b.parentNode.scrollTop=b.clientHeight+b.offsetTop-b.parentNode.clientHeight),(this||w).settings.autoComplete&&((this||w).input.autocomplete.suggest.call(this||w,x),(this||w).dropdown.position())},selectOption(b){var y=(this||w).settings.dropdown,x=y.clearOnSelect,D=y.closeOnSelect;if(!b)return this.addTags((this||w).state.inputText,!0),void(D&&(this||w).dropdown.hide());var O=b.getAttribute("tagifySuggestionIdx"),I=(this||w).suggestedListItems[+O];this.trigger("dropdown:select",{data:I,elm:b}),O&&I?((this||w).state.editing?this.onEditTagDone(null,g({__isValid:!0},this.normalizeTags([I])[0])):this["mix"==(this||w).settings.mode?"addMixTags":"addTags"]([I],x),(this||w).DOM.input.parentNode&&(setTimeout((()=>{(this||w).DOM.input.focus(),this.toggleFocusClass(!0)})),D?setTimeout((this||w).dropdown.hide.bind(this||w)):(this||w).dropdown.refilter())):(this||w).dropdown.hide()},selectAll(b){(this||w).suggestedListItems.length=0,(this||w).dropdown.hide(),(this||w).dropdown.filterListItems("");var y=(this||w).dropdown.filterListItems("");return b||(y=(this||w).state.dropdown.suggestions),this.addTags(y,!0),this||w},filterListItems(b,y){var x,D,O,I,E,N=(this||w).settings,_=N.dropdown,S=(y=y||{},b="select"==N.mode&&(this||w).value.length&&(this||w).value[0][N.tagTextProp]==b?"":b,[]),C=[],A=N.whitelist,L=_.maxItems>=0?_.maxItems:1/0,k=_.searchKeys,V=0;if(!b||!k.length)return S=N.duplicates?A:A.filter((w=>!this.isTagDuplicate(h(w)?w.value:w))),(this||w).state.dropdown.suggestions=S,S.slice(0,L);function f(w,b){return b.toLowerCase().split(" ").every((b=>w.includes(b.toLowerCase())))}for(E=_.caseSensitive?""+b:(""+b).toLowerCase();V<A.length;V++){let w,b;x=A[V]instanceof Object?A[V]:{value:A[V]};let L=Object.keys(x).some((w=>k.includes(w)))?k:["value"];_.fuzzySearch&&!y.exact?(O=L.reduce(((w,b)=>w+" "+(x[b]||"")),"").toLowerCase().trim(),_.accentedSearch&&(O=c(O),E=c(E)),w=0==O.indexOf(E),b=O===E,D=f(O,E)):(w=!0,D=L.some((w=>{var D=""+(x[w]||"");return _.accentedSearch&&(D=c(D),E=c(E)),_.caseSensitive||(D=D.toLowerCase()),b=D===E,y.exact?D===E:0==D.indexOf(E)}))),I=!N.duplicates&&this.isTagDuplicate(h(x)?x.value:x),D&&!I&&(b&&w?C.push(x):"startsWith"==_.sortby&&w?S.unshift(x):S.push(x))}return(this||w).state.dropdown.suggestions=C.concat(S),"function"==typeof _.sortby?_.sortby(C.concat(S),E):C.concat(S).slice(0,L)},getMappedValue(b){var y=(this||w).settings.dropdown.mapValueTo;return y?"function"==typeof y?y(b):b[y]||b.value:b.value},createListHTML(b){return g([],b).map(((b,y)=>{"string"!=typeof b&&"number"!=typeof b||(b={value:b});var x=(this||w).dropdown.getMappedValue(b);b.value="string"==typeof x?d(x):x;var D=(this||w).settings.templates.dropdownItem.apply(this||w,[b,this||w]);return D.replace(/\s*tagifySuggestionIdx=(["'])(.*?)\1/gim,"").replace(">",` tagifySuggestionIdx="${y}">`)})).join("")}};const x="@yaireo/tagify/";var D,O={empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed"},I={wrapper:(w,b)=>`<tags class="${b.classNames.namespace} ${b.mode?`${b.classNames[b.mode+"Mode"]}`:""} ${w.className}"\n                    ${b.readonly?"readonly":""}\n                    ${b.disabled?"disabled":""}\n                    ${b.required?"required":""}\n                    ${"select"===b.mode?"spellcheck='false'":""}\n                    tabIndex="-1">\n            <span ${!b.readonly&&b.userInput?"contenteditable":""} tabIndex="0" data-placeholder="${b.placeholder||"&#8203;"}" aria-placeholder="${b.placeholder||""}"\n                class="${b.classNames.input}"\n                role="textbox"\n                aria-autocomplete="both"\n                aria-multiline="${"mix"==b.mode}"></span>\n                &#8203;\n        </tags>`,tag(b,y){var x=(this||w).settings;return`<tag title="${b.title||b.value}"\n                    contenteditable='false'\n                    spellcheck='false'\n                    tabIndex="${x.a11y.focusableTags?0:-1}"\n                    class="${x.classNames.tag} ${b.class||""}"\n                    ${this.getAttributes(b)}>\n            <x title='' class="${x.classNames.tagX}" role='button' aria-label='remove tag'></x>\n            <div>\n                <span class="${x.classNames.tagText}">${b[x.tagTextProp]||b.value}</span>\n            </div>\n        </tag>`},dropdown(w){var b=w.dropdown,y="manual"==b.position,x=`${w.classNames.dropdown}`;return`<div class="${y?"":x} ${b.classname}" role="listbox" aria-labelledby="dropdown">\n                    <div data-selector='tagify-dropdown-wrapper' class="${w.classNames.dropdownWrapper}"></div>\n                </div>`},dropdownContent(b){var y=(this||w).settings,x=(this||w).state.dropdown.suggestions;return`\n            ${y.templates.dropdownHeader.call(this||w,x)}\n            ${b}\n            ${y.templates.dropdownFooter.call(this||w,x)}\n        `},dropdownItem(b,y){return`<div ${this.getAttributes(b)}\n                    class='${(this||w).settings.classNames.dropdownItem} ${b.class?b.class:""}'\n                    tabindex="0"\n                    role="option">${b.value}</div>`},dropdownHeader:w=>"",dropdownFooter(b){var y=b.length-(this||w).settings.dropdown.maxItems;return y>0?`<footer data-selector='tagify-suggestions-footer' class="${(this||w).settings.classNames.dropdownFooter}">\n                ${y} more items. Refine your search.\n            </footer>`:""},dropdownItemNoMatch:null};var E={customBinding(){(this||w).customEventsList.forEach((b=>{this.on(b,(this||w).settings.callbacks[b])}))},binding(b=!0){var y,x=(this||w).events.callbacks,D=b?"addEventListener":"removeEventListener";if(!(this||w).state.mainEvents||!b){for(var O in(this||w).state.mainEvents=b,b&&!(this||w).listeners.main&&((this||w).events.bindGlobal.call(this||w),(this||w).settings.isJQueryPlugin&&jQuery((this||w).DOM.originalInput).on("tagify.removeAllTags",(this||w).removeAllTags.bind(this||w))),y=(this||w).listeners.main=(this||w).listeners.main||{focus:["input",x.onFocusBlur.bind(this||w)],keydown:["input",x.onKeydown.bind(this||w)],click:["scope",x.onClickScope.bind(this||w)],dblclick:["scope",x.onDoubleClickScope.bind(this||w)],paste:["input",x.onPaste.bind(this||w)],drop:["input",x.onDrop.bind(this||w)]})(this||w).DOM[y[O][0]][D](O,y[O][1]);clearInterval((this||w).listeners.main.originalInputValueObserverInterval),(this||w).listeners.main.originalInputValueObserverInterval=setInterval(x.observeOriginalInputValue.bind(this||w),500);var I=(this||w).listeners.main.inputMutationObserver||new MutationObserver(x.onInputDOMChange.bind(this||w));I&&I.disconnect(),"mix"==(this||w).settings.mode&&I.observe((this||w).DOM.input,{childList:!0})}},bindGlobal(b){var y,x=(this||w).events.callbacks,D=b?"removeEventListener":"addEventListener";if(b||!(this||w).listeners.global)for(y of((this||w).listeners.global=(this||w).listeners&&(this||w).listeners.global||[{type:(this||w).isIE?"keydown":"input",target:(this||w).DOM.input,cb:x[(this||w).isIE?"onInputIE":"onInput"].bind(this||w)},{type:"keydown",target:window,cb:x.onWindowKeyDown.bind(this||w)},{type:"blur",target:(this||w).DOM.input,cb:x.onFocusBlur.bind(this||w)}],(this||w).listeners.global))y.target[D](y.type,y.cb)},unbindGlobal(){(this||w).events.bindGlobal.call(this||w,!0)},callbacks:{onFocusBlur(b){var y=b.target?this.trim(b.target.textContent):"",x=(this||w).settings,D=b.type,O=x.dropdown.enabled>=0,I={relatedTarget:b.relatedTarget},E=(this||w).state.actions.selectOption&&(O||!x.dropdown.closeOnSelect),N=(this||w).state.actions.addNew&&O,_=b.relatedTarget&&v.call(this||w,b.relatedTarget)&&(this||w).DOM.scope.contains(b.relatedTarget);if("blur"==D){if(b.relatedTarget===(this||w).DOM.scope)return(this||w).dropdown.hide(),void(this||w).DOM.input.focus();this.postUpdate(),this.triggerChangeEvent()}if(!E&&!N)if((this||w).state.hasFocus="focus"==D&&+new Date,this.toggleFocusClass((this||w).state.hasFocus),"mix"!=x.mode){if("focus"==D)return this.trigger("focus",I),void(0!==x.dropdown.enabled&&x.userInput||(this||w).dropdown.show((this||w).value.length?"":void 0));if("blur"==D){var S,C;this.trigger("blur",I),this.loading(!1);let b=x.enforceWhitelist?!!this.getWhitelistItem(null===(S=(this||w).value)||void 0===S||null===(C=S[0])||void 0===C?void 0:C.value):x.keepInvalidTags;"select"==(this||w).settings.mode&&_&&(y=""),"select"!==(this||w).settings.mode&&y&&!(this||w).state.actions.selectOption&&x.addTagOnBlur&&this.addTags(y,!0),"select"!=(this||w).settings.mode||y&&b||this.removeTags()}(this||w).DOM.input.removeAttribute("style"),(this||w).dropdown.hide()}else"focus"==D?this.trigger("focus",I):"blur"==b.type&&(this.trigger("blur",I),this.loading(!1),(this||w).dropdown.hide(),(this||w).state.dropdown.visible=void 0,this.setStateSelection())},onWindowKeyDown(b){var y,x=document.activeElement;if(v.call(this||w,x)&&(this||w).DOM.scope.contains(document.activeElement))switch(y=x.nextElementSibling,b.key){case"Backspace":(this||w).settings.readonly||(this.removeTags(x),(y||(this||w).DOM.input).focus());break;case"Enter":setTimeout((this||w).editTag.bind(this||w),0,x)}},onKeydown(b){var y=(this||w).settings;"select"==y.mode&&y.enforceWhitelist&&(this||w).value.length&&"Tab"!=b.key&&b.preventDefault();var x=this.trim(b.target.textContent);if(this.trigger("keydown",{originalEvent:this.cloneEvent(b)}),"mix"==y.mode){switch(b.key){case"Left":case"ArrowLeft":(this||w).state.actions.ArrowLeft=!0;break;case"Delete":case"Backspace":if((this||w).state.editing)return;var O,I,E,N=document.getSelection(),_="Delete"==b.key&&N.anchorOffset==(N.anchorNode.length||0),S=N.anchorNode.previousSibling,C=1==N.anchorNode.nodeType||!N.anchorOffset&&S&&1==S.nodeType&&N.anchorNode.previousSibling,A=o((this||w).DOM.input.innerHTML),L=this.getTagElms();if("edit"==y.backspace&&C)return O=1==N.anchorNode.nodeType?null:N.anchorNode.previousElementSibling,setTimeout((this||w).editTag.bind(this||w),0,O),void b.preventDefault();if(u()&&C)return E=l(C),C.hasAttribute("readonly")||C.remove(),(this||w).DOM.input.focus(),void setTimeout((()=>{this.placeCaretAfterNode(E),(this||w).DOM.input.click()}));if("BR"==N.anchorNode.nodeName)return;if((_||C)&&1==N.anchorNode.nodeType?I=0==N.anchorOffset?_?L[0]:null:L[N.anchorOffset-1]:_?I=N.anchorNode.nextElementSibling:C&&(I=C),3==N.anchorNode.nodeType&&!N.anchorNode.nodeValue&&N.anchorNode.previousElementSibling&&b.preventDefault(),(C||_)&&!y.backspace)return void b.preventDefault();if("Range"!=N.type&&!N.anchorOffset&&N.anchorNode==(this||w).DOM.input&&"Delete"!=b.key)return void b.preventDefault();if("Range"!=N.type&&I&&I.hasAttribute("readonly"))return void this.placeCaretAfterNode(l(I));clearTimeout(D),D=setTimeout((()=>{var b=document.getSelection(),y=o((this||w).DOM.input.innerHTML),x=!_&&b.anchorNode.previousSibling;if(y.length>=A.length&&x)if(v.call(this||w,x)&&!x.hasAttribute("readonly")){if(this.removeTags(x),this.fixFirefoxLastTagNoCaret(),2==(this||w).DOM.input.children.length&&"BR"==(this||w).DOM.input.children[1].tagName)return(this||w).DOM.input.innerHTML="",(this||w).value.length=0,!0}else x.remove();(this||w).value=[].map.call(L,((w,b)=>{var y=this.tagData(w);if(w.parentNode||y.readonly)return y;this.trigger("remove",{tag:w,index:b,data:y})})).filter((w=>w))}),20)}return!0}switch(b.key){case"Backspace":"select"==y.mode&&y.enforceWhitelist&&(this||w).value.length?this.removeTags():(this||w).state.dropdown.visible&&"manual"!=y.dropdown.position||""!=b.target.textContent&&8203!=x.charCodeAt(0)||(!0===y.backspace?this.removeTags():"edit"==y.backspace&&setTimeout((this||w).editTag.bind(this||w),0));break;case"Esc":case"Escape":if((this||w).state.dropdown.visible)return;b.target.blur();break;case"Down":case"ArrowDown":(this||w).state.dropdown.visible||(this||w).dropdown.show();break;case"ArrowRight":{let b=(this||w).state.inputSuggestion||(this||w).state.ddItemData;if(b&&y.autoComplete.rightKey)return void this.addTags([b],!0);break}case"Tab":{let w="select"==y.mode;if(!x||w)return!0;b.preventDefault()}case"Enter":if((this||w).state.dropdown.visible||229==b.keyCode)return;b.preventDefault(),setTimeout((()=>{(this||w).state.actions.selectOption||this.addTags(x,!0)}))}},onInput(b){if(this.postUpdate(),"mix"==(this||w).settings.mode)return(this||w).events.callbacks.onMixTagsInput.call(this||w,b);var y=(this||w).input.normalize.call(this||w),x=y.length>=(this||w).settings.dropdown.enabled,D={value:y,inputElm:(this||w).DOM.input};D.isValid=this.validateTag({value:y}),(this||w).state.inputText!=y&&((this||w).input.set.call(this||w,y,!1),-1!=y.search((this||w).settings.delimiters)?this.addTags(y)&&(this||w).input.set.call(this||w):(this||w).settings.dropdown.enabled>=0&&(this||w).dropdown[x?"show":"hide"](y),this.trigger("input",D))},onMixTagsInput(b){var y,x,D,O,I,E,N,_,S=(this||w).settings,C=(this||w).value.length,A=this.getTagElms(),L=document.createDocumentFragment(),k=window.getSelection().getRangeAt(0),V=[].map.call(A,(w=>this.tagData(w).value));if("deleteContentBackward"==b.inputType&&u()&&(this||w).events.callbacks.onKeydown.call(this||w,{target:b.target,key:"Backspace"}),(this||w).value.slice().forEach((w=>{w.readonly&&!V.includes(w.value)&&L.appendChild(this.createTagElem(w))})),L.childNodes.length&&(k.insertNode(L),this.setRangeAtStartEnd(!1,L.lastChild)),A.length!=C)return(this||w).value=[].map.call(this.getTagElms(),(w=>this.tagData(w))),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&(E=window.getSelection()).rangeCount>0&&3==E.anchorNode.nodeType){if((k=E.getRangeAt(0).cloneRange()).collapse(!0),k.setStart(E.focusNode,0),D=(y=k.toString().slice(0,k.endOffset)).split(S.pattern).length-1,(x=y.match(S.pattern))&&(O=y.slice(y.lastIndexOf(x[x.length-1]))),O){if((this||w).state.actions.ArrowLeft=!1,(this||w).state.tag={prefix:O.match(S.pattern)[0],value:O.replace(S.pattern,"")},(this||w).state.tag.baseOffset=E.baseOffset-(this||w).state.tag.value.length,_=(this||w).state.tag.value.match(S.delimiters))return(this||w).state.tag.value=(this||w).state.tag.value.replace(S.delimiters,""),(this||w).state.tag.delimiters=_[0],this.addTags((this||w).state.tag.value,S.dropdown.clearOnSelect),void(this||w).dropdown.hide();I=(this||w).state.tag.value.length>=S.dropdown.enabled;try{N=(N=(this||w).state.flaggedTags[(this||w).state.tag.baseOffset]).prefix==(this||w).state.tag.prefix&&N.value[0]==(this||w).state.tag.value[0],(this||w).state.flaggedTags[(this||w).state.tag.baseOffset]&&!(this||w).state.tag.value&&delete(this||w).state.flaggedTags[(this||w).state.tag.baseOffset]}catch(b){}(N||D<(this||w).state.mixMode.matchedPatternCount)&&(I=!1)}else(this||w).state.flaggedTags={};(this||w).state.mixMode.matchedPatternCount=D}setTimeout((()=>{this.update({withoutChangeEvent:!0}),this.trigger("input",g({},(this||w).state.tag,{textContent:(this||w).DOM.input.textContent})),(this||w).state.tag&&(this||w).dropdown[I?"show":"hide"]((this||w).state.tag.value)}),10)},onInputIE(b){var y=this||w;setTimeout((function(){y.events.callbacks.onInput.call(y,b)}))},observeOriginalInputValue(){(this||w).DOM.originalInput.value!=(this||w).DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickScope(b){var y=(this||w).settings,x=b.target.closest("."+y.classNames.tag),D=+new Date-(this||w).state.hasFocus;if(b.target!=(this||w).DOM.scope){if(!b.target.classList.contains(y.classNames.tagX))return x?(this.trigger("click",{tag:x,index:this.getNodeIndex(x),data:this.tagData(x),originalEvent:this.cloneEvent(b)}),void(1!==y.editTags&&1!==y.editTags.clicks||(this||w).events.callbacks.onDoubleClickScope.call(this||w,b))):void(b.target==(this||w).DOM.input&&("mix"==y.mode&&this.fixFirefoxLastTagNoCaret(),D>500)?(this||w).state.dropdown.visible?(this||w).dropdown.hide():0===y.dropdown.enabled&&"mix"!=y.mode&&(this||w).dropdown.show((this||w).value.length?"":void 0):"select"==y.mode&&!(this||w).state.dropdown.visible&&(this||w).dropdown.show());this.removeTags(b.target.parentNode)}else(this||w).state.hasFocus||(this||w).DOM.input.focus()},onPaste(b){b.preventDefault();var y,x,D=(this||w).settings;if("select"==D.mode&&D.enforceWhitelist||!D.userInput)return!1;D.readonly||(y=b.clipboardData||window.clipboardData,x=y.getData("Text"),D.hooks.beforePaste(b,{tagify:this||w,pastedText:x,clipboardData:y}).then((y=>{void 0===y&&(y=x),y&&(this.injectAtCaret(y,window.getSelection().getRangeAt(0)),"mix"==(this||w).settings.mode?(this||w).events.callbacks.onMixTagsInput.call(this||w,b):(this||w).settings.pasteAsTags?this.addTags((this||w).state.inputText+y,!0):(this||w).state.inputText=y)})).catch((w=>w)))},onDrop(w){w.preventDefault()},onEditTagInput(b,y){var x=b.closest("."+(this||w).settings.classNames.tag),D=this.getNodeIndex(x),O=this.tagData(x),I=(this||w).input.normalize.call(this||w,b),E=x.innerHTML!=x.__tagifyTagData.__originalHTML,N=this.validateTag(g(x.__tagifyTagData,{[(this||w).settings.tagTextProp]:I}));E||!0!==b.originalIsValid||(N=!0),x.classList.toggle((this||w).settings.classNames.tagInvalid,!0!==N),O.__isValid=N,x.title=!0===N?O.title||O.value:N,I.length>=(this||w).settings.dropdown.enabled&&((this||w).state.editing&&((this||w).state.editing.value=I),(this||w).dropdown.show(I)),this.trigger("edit:input",{tag:x,index:D,data:g({},(this||w).value[D],{newValue:I}),originalEvent:this.cloneEvent(y)})},onEditTagFocus(b){(this||w).state.editing={scope:b,input:b.querySelector("[contenteditable]")}},onEditTagBlur(b){if((this||w).state.hasFocus||this.toggleFocusClass(),(this||w).DOM.scope.contains(b)){var y,x,D=(this||w).settings,O=b.closest("."+D.classNames.tag),I=(this||w).input.normalize.call(this||w,b),E=this.tagData(O).__originalData,N=O.innerHTML!=O.__tagifyTagData.__originalHTML,_=this.validateTag({[D.tagTextProp]:I});if(I)if(N){if(y=this.hasMaxTags(),x=g({},E,{[D.tagTextProp]:this.trim(I),value:I,__isValid:_}),D.transformTag.call(this||w,x,E),!0!==(_=(!y||!0===E.__isValid)&&this.validateTag(x))){if(this.trigger("invalid",{data:x,tag:O,message:_}),D.editTags.keepInvalid)return;D.keepInvalidTags?x.__isValid=_:x=E}else D.keepInvalidTags&&(delete x.title,delete x["aria-invalid"],delete x.class);this.onEditTagDone(O,x)}else this.onEditTagDone(O,E);else this.onEditTagDone(O)}},onEditTagkeydown(w,b){switch(this.trigger("edit:keydown",{originalEvent:this.cloneEvent(w)}),w.key){case"Esc":case"Escape":b.innerHTML=b.__tagifyTagData.__originalHTML;case"Enter":case"Tab":w.preventDefault(),w.target.blur()}},onDoubleClickScope(b){var y,x,D=b.target.closest("."+(this||w).settings.classNames.tag),O=(this||w).settings;D&&O.userInput&&(y=D.classList.contains((this||w).settings.classNames.tagEditing),x=D.hasAttribute("readonly"),"select"==O.mode||O.readonly||y||x||!(this||w).settings.editTags||this.editTag(D),this.toggleFocusClass(!0),this.trigger("dblclick",{tag:D,index:this.getNodeIndex(D),data:this.tagData(D)}))},onInputDOMChange(b){b.forEach((b=>{b.addedNodes.forEach((b=>{if(b)if("<div><br></div>"==b.outerHTML)b.replaceWith(document.createElement("br"));else if(1==b.nodeType&&b.querySelector((this||w).settings.classNames.tagSelector)){let w=document.createTextNode("");3==b.childNodes[0].nodeType&&"BR"!=b.previousSibling.nodeName&&(w=document.createTextNode("\n")),b.replaceWith(w,...[...b.childNodes].slice(0,-1)),this.placeCaretAfterNode(w.previousSibling)}else v.call(this||w,b)&&b.previousSibling&&"BR"==b.previousSibling.nodeName&&(b.previousSibling.replaceWith("\n​"),this.placeCaretAfterNode(b.previousSibling.previousSibling))})),b.removedNodes.forEach((b=>{b&&"BR"==b.nodeName&&v.call(this||w,y)&&(this.removeTags(y),this.fixFirefoxLastTagNoCaret())}))}));var y=(this||w).DOM.input.lastChild;y&&""==y.nodeValue&&y.remove(),y&&"BR"==y.nodeName||(this||w).DOM.input.appendChild(document.createElement("br"))}}};function M(b,y){if(!b){console.warn("Tagify:","input element not found",b);const y=new Proxy(this||w,{get:()=>()=>y});return y}if(b.previousElementSibling&&b.previousElementSibling.classList.contains("tagify"))return console.warn("Tagify: ","input element is already Tagified",b),this||w;var D;g(this||w,function(b){var y=document.createTextNode("");function i(w,b,x){x&&b.split(/\s+/g).forEach((b=>y[w+"EventListener"].call(y,b,x)))}return{off(b,y){return i("remove",b,y),this||w},on(b,y){return y&&"function"==typeof y&&i("add",b,y),this||w},trigger(x,D,O){var I;if(O=O||{cloneData:!0},x)if(b.settings.isJQueryPlugin)"remove"==x&&(x="removeTag"),jQuery(b.DOM.originalInput).triggerHandler(x,[D]);else{try{var E="object"==typeof D?D:{value:D};if((E=O.cloneData?g({},E):E).tagify=this||w,D instanceof Object)for(var N in D)D[N]instanceof HTMLElement&&(E[N]=D[N]);I=new CustomEvent(x,{detail:E})}catch(w){console.warn(w)}y.dispatchEvent(I)}}}}(this||w)),(this||w).isFirefox="undefined"!=typeof InstallTrigger,(this||w).isIE=window.document.documentMode,y=y||{},(this||w).getPersistedData=(D=y.id,w=>{let b,y="/"+w;if(1==localStorage.getItem(x+D+"/v",1))try{b=JSON.parse(localStorage[x+D+y])}catch(w){}return b}),(this||w).setPersistedData=(w=>w?(localStorage.setItem(x+w+"/v",1),(b,y)=>{let D="/"+y,O=JSON.stringify(b);b&&y&&(localStorage.setItem(x+w+D,O),dispatchEvent(new Event("storage")))}):()=>{})(y.id),(this||w).clearPersistedData=(w=>b=>{const y=x+"/"+w+"/";if(b)localStorage.removeItem(y+b);else for(let w in localStorage)w.includes(y)&&localStorage.removeItem(w)})(y.id),this.applySettings(b,y),(this||w).state={inputText:"",editing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},(this||w).value=[],(this||w).listeners={},(this||w).DOM={},this.build(b),T.call(this||w),this.getCSSVars(),this.loadOriginalValues(),(this||w).events.customBinding.call(this||w),(this||w).events.binding.call(this||w),b.autofocus&&(this||w).DOM.input.focus()}return M.prototype={_dropdown:y,helpers:{sameStr:s,removeCollectionProp:a,omit:n,isObject:h,parseHTML:r,escapeHTML:d,extend:g,concatWithoutDups:p,getUID:m,isNodeTag:v},customEventsList:["change","add","remove","invalid","input","click","keydown","focus","blur","edit:input","edit:beforeUpdate","edit:updated","edit:start","edit:keydown","dropdown:show","dropdown:hide","dropdown:select","dropdown:updated","dropdown:noMatch","dropdown:scroll"],dataProps:["__isValid","__removed","__originalData","__originalHTML","__tagId"],trim(b){return(this||w).settings.trim&&b&&"string"==typeof b?b.trim():b},parseHTML:r,templates:I,parseTemplate(b,y){return b=(this||w).settings.templates[b]||b,this.parseHTML(b.apply(this||w,y))},set whitelist(b){const y=b&&Array.isArray(b);(this||w).settings.whitelist=y?b:[],this.setPersistedData(y?b:[],"whitelist")},get whitelist(){return(this||w).settings.whitelist},applySettings(y,x){b.templates=(this||w).templates;var D=(this||w).settings=g({},b,x);D.disabled=y.hasAttribute("disabled"),D.readonly=D.readonly||y.hasAttribute("readonly"),D.placeholder=d(y.getAttribute("placeholder")||D.placeholder||""),D.required=y.hasAttribute("required");for(let b in D.classNames)Object.defineProperty(D.classNames,b+"Selector",{get(){return"."+(this||w)[b].split(" ")[0]}});if((this||w).isIE&&(D.autoComplete=!1),["whitelist","blacklist"].forEach((w=>{var b=y.getAttribute("data-"+w);b&&(b=b.split(D.delimiters))instanceof Array&&(D[w]=b)})),"autoComplete"in x&&!h(x.autoComplete)&&(D.autoComplete=b.autoComplete,D.autoComplete.enabled=x.autoComplete),"mix"==D.mode&&(D.autoComplete.rightKey=!0,D.delimiters=x.delimiters||null,D.tagTextProp&&!D.dropdown.searchKeys.includes(D.tagTextProp)&&D.dropdown.searchKeys.push(D.tagTextProp)),y.pattern)try{D.pattern=new RegExp(y.pattern)}catch(y){}if((this||w).settings.delimiters)try{D.delimiters=new RegExp((this||w).settings.delimiters,"g")}catch(y){}D.disabled&&(D.userInput=!1),(this||w).TEXTS=e(e({},O),D.texts||{}),"select"!=D.mode&&D.userInput||(D.dropdown.enabled=0),D.dropdown.appendTarget=x.dropdown&&x.dropdown.appendTarget?x.dropdown.appendTarget:document.body;let I=this.getPersistedData("whitelist");Array.isArray(I)&&((this||w).whitelist=Array.isArray(D.whitelist)?p(D.whitelist,I):I)},getAttributes(w){var b,y=this.getCustomAttributes(w),x="";for(b in y)x+=" "+b+(void 0!==w[b]?`="${y[b]}"`:"");return x},getCustomAttributes(w){if(!h(w))return"";var b,y={};for(b in w)"__"!=b.slice(0,2)&&"class"!=b&&w.hasOwnProperty(b)&&void 0!==w[b]&&(y[b]=d(w[b]));return y},setStateSelection(){var b=window.getSelection(),y={anchorOffset:b.anchorOffset,anchorNode:b.anchorNode,range:b.getRangeAt&&b.rangeCount&&b.getRangeAt(0)};return(this||w).state.selection=y,y},getCaretGlobalPosition(){const w=document.getSelection();if(w.rangeCount){const b=w.getRangeAt(0),y=b.startContainer,x=b.startOffset;let D,O;if(x>0)return O=document.createRange(),O.setStart(y,x-1),O.setEnd(y,x),D=O.getBoundingClientRect(),{left:D.right,top:D.top,bottom:D.bottom};if(y.getBoundingClientRect)return y.getBoundingClientRect()}return{left:-9999,top:-9999}},getCSSVars(){var b=getComputedStyle((this||w).DOM.scope,null);var y;(this||w).CSSVars={tagHideTransition:(({value:w,unit:b})=>"s"==b?1e3*w:w)(function(w){if(!w)return{};var b=(w=w.trim().split(" ")[0]).split(/\d+/g).filter((w=>w)).pop().trim();return{value:+w.split(b).filter((w=>w))[0].trim(),unit:b}}((y="tag-hide-transition",b.getPropertyValue("--"+y))))}},build(b){var y=(this||w).DOM;(this||w).settings.mixMode.integrated?(y.originalInput=null,y.scope=b,y.input=b):(y.originalInput=b,y.originalInput_tabIndex=b.tabIndex,y.scope=this.parseTemplate("wrapper",[b,(this||w).settings]),y.input=y.scope.querySelector((this||w).settings.classNames.inputSelector),b.parentNode.insertBefore(y.scope,b),b.tabIndex=-1)},destroy(){(this||w).events.unbindGlobal.call(this||w),(this||w).DOM.scope.parentNode.removeChild((this||w).DOM.scope),(this||w).DOM.originalInput.tabIndex=(this||w).DOM.originalInput_tabIndex,(this||w).dropdown.hide(!0),clearTimeout((this||w).dropdownHide__bindEventsTimeout)},loadOriginalValues(b){var y,x=(this||w).settings;if((this||w).state.blockChangeEvent=!0,void 0===b){const y=this.getPersistedData("value");b=y&&!(this||w).DOM.originalInput.value?y:x.mixMode.integrated?(this||w).DOM.input.textContent:(this||w).DOM.originalInput.value}if(this.removeAllTags(),b)if("mix"==x.mode)this.parseMixTags(this.trim(b)),(y=(this||w).DOM.input.lastChild)&&"BR"==y.tagName||(this||w).DOM.input.insertAdjacentHTML("beforeend","<br>");else{try{JSON.parse(b)instanceof Array&&(b=JSON.parse(b))}catch(b){}this.addTags(b).forEach((w=>w&&w.classList.add(x.classNames.tagNoAnimation)))}else this.postUpdate();(this||w).state.lastOriginalValueReported=x.mixMode.integrated?"":(this||w).DOM.originalInput.value,(this||w).state.blockChangeEvent=!1},cloneEvent(w){var b={};for(var y in w)b[y]=w[y];return b},loading(b){return(this||w).state.isLoading=b,(this||w).DOM.scope.classList[b?"add":"remove"]((this||w).settings.classNames.scopeLoading),this||w},tagLoading(b,y){return b&&b.classList[y?"add":"remove"]((this||w).settings.classNames.tagLoading),this||w},toggleClass(b,y){"string"==typeof b&&(this||w).DOM.scope.classList.toggle(b,y)},toggleFocusClass(b){this.toggleClass((this||w).settings.classNames.focus,!!b)},triggerChangeEvent:function(){if(!(this||w).settings.mixMode.integrated){var b=(this||w).DOM.originalInput,y=(this||w).state.lastOriginalValueReported!==b.value,x=new CustomEvent("change",{bubbles:!0});y&&((this||w).state.lastOriginalValueReported=b.value,x.simulated=!0,b._valueTracker&&b._valueTracker.setValue(Math.random()),b.dispatchEvent(x),this.trigger("change",(this||w).state.lastOriginalValueReported),b.value=(this||w).state.lastOriginalValueReported)}},events:E,fixFirefoxLastTagNoCaret(){},placeCaretAfterNode(w){if(w&&w.parentNode){var b=w.nextSibling,y=window.getSelection(),x=y.getRangeAt(0);y.rangeCount&&(x.setStartAfter(b||w),x.collapse(!0),y.removeAllRanges(),y.addRange(x))}},insertAfterTag(b,y){if(y=y||(this||w).settings.mixMode.insertAfterTag,b&&b.parentNode&&y)return y="string"==typeof y?document.createTextNode(y):y,b.parentNode.insertBefore(y,b.nextSibling),y},editTag(b,y){b=b||this.getLastTag(),y=y||{},(this||w).dropdown.hide();var x=(this||w).settings;function s(){return b.querySelector(x.classNames.tagTextSelector)}var D=s(),O=this.getNodeIndex(b),I=this.tagData(b),E=(this||w).events.callbacks,N=this||w,_=!0;if(D){if(!(I instanceof Object&&"editable"in I)||I.editable)return D.setAttribute("contenteditable",!0),b.classList.add(x.classNames.tagEditing),this.tagData(b,{__originalData:g({},I),__originalHTML:b.innerHTML}),D.addEventListener("focus",E.onEditTagFocus.bind(this||w,b)),D.addEventListener("blur",(function(){setTimeout((()=>E.onEditTagBlur.call(N,s())))})),D.addEventListener("input",E.onEditTagInput.bind(this||w,D)),D.addEventListener("keydown",(y=>E.onEditTagkeydown.call(this||w,y,b))),D.focus(),this.setRangeAtStartEnd(!1,D),y.skipValidation||(_=this.editTagToggleValidity(b)),D.originalIsValid=_,this.trigger("edit:start",{tag:b,index:O,data:I,isValid:_}),this||w}else console.warn("Cannot find element in Tag template: .",x.classNames.tagTextSelector)},editTagToggleValidity(b,y){var x;if(y=y||this.tagData(b))return(x=!("__isValid"in y)||!0===y.__isValid)||this.removeTagsFromValue(b),this.update(),b.classList.toggle((this||w).settings.classNames.tagNotAllowed,!x),y.__isValid;console.warn("tag has no data: ",b,y)},onEditTagDone(b,y){y=y||{};var x={tag:b=b||(this||w).state.editing.scope,index:this.getNodeIndex(b),previousData:this.tagData(b),data:y};this.trigger("edit:beforeUpdate",x,{cloneData:!1}),(this||w).state.editing=!1,delete y.__originalData,delete y.__originalHTML,b&&y[(this||w).settings.tagTextProp]?(b=this.replaceTag(b,y),this.editTagToggleValidity(b,y),(this||w).settings.a11y.focusableTags?b.focus():this.placeCaretAfterNode(b.previousSibling)):b&&this.removeTags(b),this.trigger("edit:updated",x),(this||w).dropdown.hide(),(this||w).settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag(w,b){b&&b.value||(b=w.__tagifyTagData),b.__isValid&&1!=b.__isValid&&g(b,this.getInvalidTagAttrs(b,b.__isValid));var y=this.createTagElem(b);return w.parentNode.replaceChild(y,w),this.updateValueByDOMTags(),y},updateValueByDOMTags(){(this||w).value.length=0,[].forEach.call(this.getTagElms(),(b=>{b.classList.contains((this||w).settings.classNames.tagNotAllowed.split(" ")[0])||(this||w).value.push(this.tagData(b))})),this.update()},setRangeAtStartEnd(b,y){b="number"==typeof b?b:!!b,y=(y=y||(this||w).DOM.input).lastChild||y;var x=document.getSelection();try{x.rangeCount>=1&&["Start","End"].forEach((w=>x.getRangeAt(0)["set"+w](y,b||y.length)))}catch(b){}},injectAtCaret(b,y){if(y=y||(this||w).state.selection.range)return"string"==typeof b&&(b=document.createTextNode(b)),y.deleteContents(),y.insertNode(b),this.setRangeAtStartEnd(!1,b),this.updateValueByDOMTags(),this.update(),this||w},input:{set(b="",y=!0){var x=(this||w).settings.dropdown.closeOnSelect;(this||w).state.inputText=b,y&&((this||w).DOM.input.innerHTML=d(""+b)),!b&&x&&(this||w).dropdown.hide.bind(this||w),(this||w).input.autocomplete.suggest.call(this||w),(this||w).input.validate.call(this||w)},raw(){return(this||w).DOM.input.textContent},validate(){var b=!(this||w).state.inputText||!0===this.validateTag({value:(this||w).state.inputText});return(this||w).DOM.input.classList.toggle((this||w).settings.classNames.inputInvalid,!b),b},normalize(b){var y=b||(this||w).DOM.input,x=[];y.childNodes.forEach((w=>3==w.nodeType&&x.push(w.nodeValue))),x=x.join("\n");try{x=x.replace(/(?:\r\n|\r|\n)/g,(this||w).settings.delimiters.source.charAt(0))}catch(b){}return x=x.replace(/\s/g," "),(this||w).settings.trim&&(x=x.replace(/^\s+/,"")),this.trim(x)},autocomplete:{suggest(b){if((this||w).settings.autoComplete.enabled){"string"==typeof(b=b||{})&&(b={value:b});var y=b.value?""+b.value:"",x=y.substr(0,(this||w).state.inputText.length).toLowerCase(),D=y.substring((this||w).state.inputText.length);y&&(this||w).state.inputText&&x==(this||w).state.inputText.toLowerCase()?((this||w).DOM.input.setAttribute("data-suggest",D),(this||w).state.inputSuggestion=b):((this||w).DOM.input.removeAttribute("data-suggest"),delete(this||w).state.inputSuggestion)}},set(b){var y=(this||w).DOM.input.getAttribute("data-suggest"),x=b||(y?(this||w).state.inputText+y:null);return!!x&&("mix"==(this||w).settings.mode?this.replaceTextWithNode(document.createTextNode((this||w).state.tag.prefix+x)):((this||w).input.set.call(this||w,x),this.setRangeAtStartEnd()),(this||w).input.autocomplete.suggest.call(this||w),(this||w).dropdown.hide(),!0)}}},getTagIdx(b){return(this||w).value.findIndex((w=>w.__tagId==(b||{}).__tagId))},getNodeIndex(w){var b=0;if(w)for(;w=w.previousElementSibling;)b++;return b},getTagElms(...b){var y="."+[...(this||w).settings.classNames.tag.split(" "),...b].join(".");return[].slice.call((this||w).DOM.scope.querySelectorAll(y))},getLastTag(){var b=(this||w).DOM.scope.querySelectorAll(`${(this||w).settings.classNames.tagSelector}:not(.${(this||w).settings.classNames.tagHide}):not([readonly])`);return b[b.length-1]},tagData:(w,b,y)=>w?(b&&(w.__tagifyTagData=y?b:g({},w.__tagifyTagData||{},b)),w.__tagifyTagData):(console.warn("tag element doesn't exist",w,b),b),isTagDuplicate(b,y,x){var D=(this||w).settings;return"select"!=D.mode&&(this||w).value.reduce(((w,O)=>s(this.trim(""+b),O.value,y||D.dropdown.caseSensitive)&&x!=O.__tagId?w+1:w),0)},getTagIndexByValue(b){var y=[];return this.getTagElms().forEach(((x,D)=>{s(this.trim(x.textContent),b,(this||w).settings.dropdown.caseSensitive)&&y.push(D)})),y},getTagElmByValue(w){var b=this.getTagIndexByValue(w)[0];return this.getTagElms()[b]},flashTag(b){b&&(b.classList.add((this||w).settings.classNames.tagFlash),setTimeout((()=>{b.classList.remove((this||w).settings.classNames.tagFlash)}),100))},isTagBlacklisted(b){return b=this.trim(b.toLowerCase()),(this||w).settings.blacklist.filter((w=>(""+w).toLowerCase()==b)).length},isTagWhitelisted(w){return!!this.getWhitelistItem(w)},getWhitelistItem(b,y,x){y=y||"value";var D,O=(this||w).settings;return(x=x||O.whitelist).some((w=>{var x="string"==typeof w?w:w[y]||w.value;if(s(x,b,O.dropdown.caseSensitive,O.trim))return D="string"==typeof w?{value:w}:w,!0})),D||"value"!=y||"value"==O.tagTextProp||(D=this.getWhitelistItem(b,O.tagTextProp,x)),D},validateTag(b){var y=(this||w).settings,x="value"in b?"value":y.tagTextProp,D=this.trim(b[x]+"");return(b[x]+"").trim()?y.pattern&&y.pattern instanceof RegExp&&!y.pattern.test(D)?(this||w).TEXTS.pattern:!y.duplicates&&this.isTagDuplicate(D,(this||w).state.editing,b.__tagId)?(this||w).TEXTS.duplicate:this.isTagBlacklisted(D)||y.enforceWhitelist&&!this.isTagWhitelisted(D)?(this||w).TEXTS.notAllowed:!y.validate||y.validate(b):(this||w).TEXTS.empty},getInvalidTagAttrs(b,y){return{"aria-invalid":!0,class:`${b.class||""} ${(this||w).settings.classNames.tagNotAllowed}`.trim(),title:y}},hasMaxTags(){return(this||w).value.length>=(this||w).settings.maxTags&&(this||w).TEXTS.exceed},setReadonly(b,y){var x=(this||w).settings;document.activeElement.blur(),x[y||"readonly"]=b,(this||w).DOM.scope[(b?"set":"remove")+"Attribute"](y||"readonly",!0),this.setContentEditable(!b)},setContentEditable(b){!(this||w).settings.readonly&&(this||w).settings.userInput&&((this||w).DOM.input.contentEditable=b,(this||w).DOM.input.tabIndex=b?0:-1)},setDisabled(w){this.setReadonly(w,"disabled")},normalizeTags(b){var y=(this||w).settings,x=y.whitelist,D=y.delimiters,O=y.mode,I=y.tagTextProp;y.enforceWhitelist;var E=[],N=!!x&&x[0]instanceof Object,_=b instanceof Array,d=w=>(w+"").split(D).filter((w=>w)).map((w=>({[I]:this.trim(w),value:this.trim(w)})));if("number"==typeof b&&(b=b.toString()),"string"==typeof b){if(!b.trim())return[];b=d(b)}else _&&(b=[].concat(...b.map((w=>w.value?w:d(w)))));return N&&(b.forEach((b=>{var y=E.map((w=>w.value)),x=(this||w).dropdown.filterListItems.call(this||w,b[I],{exact:!0});(this||w).settings.duplicates||(x=x.filter((w=>!y.includes(w.value))));var D=x.length>1?this.getWhitelistItem(b[I],I,x):x[0];D&&D instanceof Object?E.push(D):"mix"!=O&&(null==b.value&&(b.value=b[I]),E.push(b))})),E.length&&(b=E)),b},parseMixTags(b){var y=(this||w).settings,x=y.mixTagsInterpolator,D=y.duplicates,O=y.transformTag,I=y.enforceWhitelist,E=y.maxTags,N=y.tagTextProp,_=[];return b=b.split(x[0]).map(((b,y)=>{var S,C,A,L=b.split(x[1]),k=L[0],V=_.length==E;try{if(k==+k)throw Error;C=JSON.parse(k)}catch(b){C=this.normalizeTags(k)[0]||{value:k}}if(O.call(this||w,C),V||!(L.length>1)||I&&!this.isTagWhitelisted(C.value)||!D&&this.isTagDuplicate(C.value)){if(b)return y?x[0]+b:b}else C[S=C[N]?N:"value"]=this.trim(C[S]),A=this.createTagElem(C),_.push(C),A.classList.add((this||w).settings.classNames.tagNoAnimation),L[0]=A.outerHTML,(this||w).value.push(C);return L.join("")})).join(""),(this||w).DOM.input.innerHTML=b,(this||w).DOM.input.appendChild(document.createTextNode("")),(this||w).DOM.input.normalize(),this.getTagElms().forEach(((w,b)=>this.tagData(w,_[b]))),this.update({withoutChangeEvent:!0}),b},replaceTextWithNode(b,y){if((this||w).state.tag||y){y=y||(this||w).state.tag.prefix+(this||w).state.tag.value;var x,D,O=window.getSelection(),I=O.anchorNode,E=(this||w).state.tag.delimiters?(this||w).state.tag.delimiters.length:0;return I.splitText(O.anchorOffset-E),-1==(x=I.nodeValue.lastIndexOf(y))||(D=I.splitText(x),b&&I.parentNode.replaceChild(b,D)),!0}},selectTag(b,y){var x=(this||w).settings;if(!x.enforceWhitelist||this.isTagWhitelisted(y.value)){(this||w).input.set.call(this||w,y[x.tagTextProp]||y.value,!0),(this||w).state.actions.selectOption&&setTimeout((this||w).setRangeAtStartEnd.bind(this||w));var D=this.getLastTag();return D?this.replaceTag(D,y):this.appendTag(b),(this||w).value[0]=y,this.update(),this.trigger("add",{tag:b,data:y}),[b]}},addEmptyTag(w){var b=g({value:""},w||{}),y=this.createTagElem(b);this.tagData(y,b),this.appendTag(y),this.editTag(y,{skipValidation:!0})},addTags(b,y,x){var D=[],O=(this||w).settings,I=document.createDocumentFragment();return x=x||O.skipInvalid,b&&0!=b.length?(b=this.normalizeTags(b),"mix"==O.mode?this.addMixTags(b):("select"==O.mode&&(y=!1),(this||w).DOM.input.removeAttribute("style"),b.forEach((b=>{var y,E={},N=Object.assign({},b,{value:b.value+""});if(b=Object.assign({},N),O.transformTag.call(this||w,b),b.__isValid=this.hasMaxTags()||this.validateTag(b),!0!==b.__isValid){if(x)return;g(E,this.getInvalidTagAttrs(b,b.__isValid),{__preInvalidData:N}),b.__isValid==(this||w).TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(b.value))}if("readonly"in b&&(b.readonly?E["aria-readonly"]=!0:delete b.readonly),y=this.createTagElem(b,E),D.push(y),"select"==O.mode)return this.selectTag(y,b);I.appendChild(y),b.__isValid&&!0===b.__isValid?((this||w).value.push(b),this.trigger("add",{tag:y,index:(this||w).value.length-1,data:b})):(this.trigger("invalid",{data:b,index:(this||w).value.length,tag:y,message:b.__isValid}),O.keepInvalidTags||setTimeout((()=>this.removeTags(y,!0)),1e3)),(this||w).dropdown.position()})),this.appendTag(I),this.update(),b.length&&y&&(this||w).input.set.call(this||w),(this||w).dropdown.refilter(),D)):("select"==O.mode&&this.removeAllTags(),D)},addMixTags(b){if((b=this.normalizeTags(b))[0].prefix||(this||w).state.tag)return this.prefixedTextToTag(b[0]);"string"==typeof b&&(b=[{value:b}]);var y=!!(this||w).state.selection,x=document.createDocumentFragment();return b.forEach((w=>{var b=this.createTagElem(w);x.appendChild(b),this.insertAfterTag(b)})),y?this.injectAtCaret(x):((this||w).DOM.input.focus(),(y=this.setStateSelection()).range.setStart((this||w).DOM.input,y.range.endOffset),y.range.setEnd((this||w).DOM.input,y.range.endOffset),(this||w).DOM.input.appendChild(x),this.updateValueByDOMTags(),this.update()),x},prefixedTextToTag(b){var y,x=(this||w).settings,D=(this||w).state.tag.delimiters;if(x.transformTag.call(this||w,b),b.prefix=b.prefix||(this||w).state.tag?(this||w).state.tag.prefix:(x.pattern.source||x.pattern)[0],y=this.createTagElem(b),this.replaceTextWithNode(y)||(this||w).DOM.input.appendChild(y),setTimeout((()=>y.classList.add((this||w).settings.classNames.tagNoAnimation)),300),(this||w).value.push(b),this.update(),!D){var O=this.insertAfterTag(y)||y;this.placeCaretAfterNode(O)}return(this||w).state.tag=null,this.trigger("add",g({},{tag:y},{data:b})),y},appendTag(b){var y=(this||w).DOM,x=y.input;x===y.input?y.scope.insertBefore(b,x):y.scope.appendChild(b)},createTagElem(w,b){w.__tagId=m();var y,x=g({},w,e({value:d(w.value+"")},b));return function(w){for(var b,y=document.createNodeIterator(w,NodeFilter.SHOW_TEXT,null,!1);b=y.nextNode();)b.textContent.trim()||b.parentNode.removeChild(b)}(y=this.parseTemplate("tag",[x])),this.tagData(y,w),y},reCheckInvalidTags(){var b=(this||w).settings;this.getTagElms(b.classNames.tagNotAllowed).forEach(((w,b)=>{var y=this.tagData(w),x=this.hasMaxTags(),D=this.validateTag(y);if(!0===D&&!x)return y=y.__preInvalidData?y.__preInvalidData:{value:y.value},this.replaceTag(w,y);w.title=x||D}))},removeTags(b,y,x){var D;if(b=b&&b instanceof HTMLElement?[b]:b instanceof Array?b:b?[b]:[this.getLastTag()],D=b.reduce(((w,b)=>{b&&"string"==typeof b&&(b=this.getTagElmByValue(b));var y=this.tagData(b);return b&&y&&!y.readonly&&w.push({node:b,idx:this.getTagIdx(y),data:this.tagData(b,{__removed:!0})}),w}),[]),x="number"==typeof x?x:(this||w).CSSVars.tagHideTransition,"select"==(this||w).settings.mode&&(x=0,(this||w).input.set.call(this||w)),1==D.length&&D[0].node.classList.contains((this||w).settings.classNames.tagNotAllowed)&&(y=!0),D.length)return(this||w).settings.hooks.beforeRemoveTag(D,{tagify:this||w}).then((()=>{function t(b){b.node.parentNode&&(b.node.parentNode.removeChild(b.node),y?(this||w).settings.keepInvalidTags&&this.trigger("remove",{tag:b.node,index:b.idx}):(this.trigger("remove",{tag:b.node,index:b.idx,data:b.data}),(this||w).dropdown.refilter(),(this||w).dropdown.position(),(this||w).DOM.input.normalize(),(this||w).settings.keepInvalidTags&&this.reCheckInvalidTags()))}x&&x>10&&1==D.length?function(b){b.node.style.width=parseFloat(window.getComputedStyle(b.node).width)+"px",document.body.clientTop,b.node.classList.add((this||w).settings.classNames.tagHide),setTimeout(t.bind(this||w),x,b)}.call(this||w,D[0]):D.forEach(t.bind(this||w)),y||(this.removeTagsFromValue(D.map((w=>w.node))),this.update(),"select"==(this||w).settings.mode&&this.setContentEditable(!0))})).catch((w=>{}))},removeTagsFromDOM(){[].slice.call(this.getTagElms()).forEach((w=>w.parentNode.removeChild(w)))},removeTagsFromValue(b){(b=Array.isArray(b)?b:[b]).forEach((b=>{var y=this.tagData(b),x=this.getTagIdx(y);x>-1&&(this||w).value.splice(x,1)}))},removeAllTags(b){b=b||{},(this||w).value=[],"mix"==(this||w).settings.mode?(this||w).DOM.input.innerHTML="":this.removeTagsFromDOM(),(this||w).dropdown.position(),"select"==(this||w).settings.mode&&((this||w).input.set.call(this||w),this.setContentEditable(!0)),this.update(b)},postUpdate(){var b=(this||w).settings.classNames,y="mix"==(this||w).settings.mode?(this||w).settings.mixMode.integrated?(this||w).DOM.input.textContent:(this||w).DOM.originalInput.value.trim():(this||w).value.length+(this||w).input.raw.call(this||w).length;this.toggleClass(b.hasMaxTags,(this||w).value.length>=(this||w).settings.maxTags),this.toggleClass(b.hasNoTags,!(this||w).value.length),this.toggleClass(b.empty,!y)},setOriginalInputValue(b){var y=(this||w).DOM.originalInput;(this||w).settings.mixMode.integrated||(y.value=b,y.tagifyValue=y.value,this.setPersistedData(b,"value"))},update(b){var y=this.getInputValue();this.setOriginalInputValue(y),this.postUpdate(),(b||{}).withoutChangeEvent||(this||w).state.blockChangeEvent||this.triggerChangeEvent()},getInputValue(){var b=this.getCleanValue();return"mix"==(this||w).settings.mode?this.getMixedTagsAsString(b):b.length?(this||w).settings.originalInputValueFormat?(this||w).settings.originalInputValueFormat(b):JSON.stringify(b):""},getCleanValue(b){return a(b||(this||w).value,(this||w).dataProps)},getMixedTagsAsString(){var b="",y=this||w,x=(this||w).settings.mixTagsInterpolator;return function s(w){w.childNodes.forEach((w=>{if(1==w.nodeType){const D=y.tagData(w);if("BR"==w.tagName&&(b+="\r\n"),w.getAttribute("style")||["B","I","U"].includes(w.tagName))b+=w.textContent;else if("DIV"==w.tagName||"P"==w.tagName)b+="\r\n",s(w);else if(v.call(y,w)&&D){if(D.__removed)return;b+=x[0]+JSON.stringify(n(D,y.dataProps))+x[1]}}else b+=w.textContent}))}((this||w).DOM.input),b}},M.prototype.removeTag=M.prototype.removeTags,M}));var y=b;export{y as default};

//# sourceMappingURL=tagify.min.js.map